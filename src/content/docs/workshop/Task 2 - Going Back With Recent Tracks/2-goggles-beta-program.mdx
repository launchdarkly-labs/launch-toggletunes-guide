---
sidebar_position: 2
title: Beta Program - Goggle Expansion!
---

## Showing Off Those Fancy Goggles
Now that we've created our new Beta User segment, we can create a new targeting rule and set up our API to access our new product portfolio. At ToggleCon, we had a number of folks sign up for our early access program and this is a highly anticipated release. Fortunately, we've done the internal testing in a separate sprint and our Beta Users are well aware that there might be some hiccups. So let's get started! 


### Step 1: Add Targeting Rule to Your Flag
Head back out to the flag that you just created and select the `+Add Rules` option. We need to create a rule that targets our new beta segment, it should look something like this: 

![](@assets/img/beta-release-rule.png)

Now our flag is ready to go, time to head to the code!

### Step 2: Update the code

Next, we're going to update our API to return goggles when our feature is enabled for the target audience. Open the `/src/pages/api/products.ts` file. This file controls what products get returned from the products API.  

Replace the code between the comment blocks on line 82 with this code:

```jsx title='/src/pages/api/products.ts'
// this function retrieves our product catalog from the Stripe API based on our flag values. 
// If you want to see the flag evaluations, check out the `/src/utils/product-helpers.ts` 

if (req.method === "GET") {
    if (enableStripe) {
    retrieveProducts(req, res)
  }
  else {
      return res.json(product);
    }
  }
```

With this code in place, we're ready to start using Release Targeting entitle users to the new products within Toggle Outfitters. Let's go! 

### Step 3: Opt-In! Behold Our New Goggles
First, make sure you have turned on targeting for the "New Product Experience Access" flag and that the default variation being served when targeting is on is the one containing just "toggle".

Within Toggle Outfiters, hover over the button displaying your username, you should see a screen like this:

![](@assets/img/login-box.png)

Notice the enrollment option for the Early Access Program? Go ahead and enroll and voila! Goggles! 

Just to prove that it's targeting based on the enrollment, go ahead and log out, then log back in with a different username. No Goggles right!? Pretty cool! But how are we doing this? Well a couple of times, we've talked about context attributes, let's review contexts in a bit more depth.

:::caution[Having Issues?]
<details>
<summary>Click here for some troubleshooting tips</summary>
<p>
If you aren't seeing the expected behavior, here are some possible fixes:
</p>
<ul> 
<li>If you aren't seeing the Goggles when you opt into the Beta, double check that the API is working. Remove the rule and target everyone with the <code>Toggles and Goggles</code> variation.</li>
<li>If that works, make sure you've selected the proper <code>inBeta</code> attribute and the value is <code>true</code> with a <code>bool</code> next to it.</li>
<li>If nothing happens when you serve both <code>Toggles and Goggles</code>:</li>
<ul> 
<li>check that you created a <code>string</code> flag</li> 
<li>check the spelling on your values</li> 
<li>check the flag key</li>
<li>check the code you pasted in the <code>products.ts</code> file.</li>
</ul>
</ul>
</details>    



























